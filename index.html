<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Survey Says - Macy's Edition!</title>
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #c41e3a 0%, #165b33 50%, #c41e3a 100%);
            background-size: 400% 400%;
            animation: festiveGradient 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: "‚ùÑÔ∏è ‚õÑ üéÑ ‚ùÑÔ∏è ‚õÑ üéÑ ‚ùÑÔ∏è ‚õÑ üéÑ ‚ùÑÔ∏è ‚õÑ üéÑ ‚ùÑÔ∏è ‚õÑ üéÑ";
            position: fixed;
            top: 10px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.5em;
            z-index: 1;
            pointer-events: none;
        }

        body::after {
            content: "üéÅ ‚≠ê üîî üéÅ ‚≠ê üîî üéÅ ‚≠ê üîî üéÅ ‚≠ê üîî üéÅ ‚≠ê üîî";
            position: fixed;
            bottom: 10px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 1.5em;
            z-index: 1;
            pointer-events: none;
        }

        @keyframes festiveGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #faf8f3;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            padding: 40px;
            position: relative;
            z-index: 2;
            border: 3px solid #d4af37;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .christmas-banner {
            width: 100%;
            max-width: 600px;
            height: auto;
            border-radius: 15px;
            margin: 0 auto 20px;
            display: block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: #c41e3a;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .setup-screen, .game-screen {
            display: none;
        }

        .setup-screen.active, .game-screen.active {
            display: block;
        }

        .role-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .role-card {
            background: #f5f3ed;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            flex: 1;
            max-width: 300px;
            text-align: center;
            min-width: 250px;
        }

        .role-card:hover {
            transform: translateY(-5px);
            border-color: #165b33;
            box-shadow: 0 10px 30px rgba(22, 91, 51, 0.4);
        }

        .role-card h2 {
            color: #c41e3a;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .role-card p {
            color: #666;
            line-height: 1.6;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .input-group input:focus {
            outline: none;
            border-color: #165b33;
        }

        button {
            background: #c41e3a;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        button:hover:not(:disabled) {
            background: #165b33;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .game-code {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe4b3 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            border: 3px solid #d4af37;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .game-code h3 {
            color: #165b33;
            margin-bottom: 10px;
        }

        .game-code .code {
            font-size: 2em;
            font-weight: bold;
            color: #c41e3a;
            letter-spacing: 3px;
            font-family: 'Courier New', monospace;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .game-code .url {
            font-size: 0.9em;
            color: #165b33;
            margin-top: 10px;
            word-break: break-all;
        }

        .question-section {
            background: #f5f3ed;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .question-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .question-number {
            color: #165b33;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 25px;
            font-weight: bold;
            text-align: center;
        }

        .timer {
            text-align: center;
            font-size: 3em;
            color: #c41e3a;
            font-weight: bold;
            margin: 20px 0;
        }

        .timer.warning {
            color: #dc3545;
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .answers-grid {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .answer-option {
            background: white;
            border: 3px solid #165b33;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .answer-option:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(22, 91, 51, 0.4);
        }

        .answer-option.selected {
            background: #c41e3a;
            color: white;
            border-color: #c41e3a;
        }

        .answer-option.revealed {
            background: #165b33;
            color: white;
            border-color: #165b33;
        }

        .answer-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .answer-option .points {
            background: #d4af37;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
        }

        .answer-option.revealed .points {
            display: block;
        }

        .players-list {
            background: #f5f3ed;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .players-list h3 {
            color: #c41e3a;
            margin-bottom: 15px;
        }

        .player-item {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-item.answered {
            background: #d4edda;
        }

        .player-name {
            font-weight: bold;
            color: #333;
        }

        .player-score {
            background: #165b33;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .player-status {
            font-size: 0.9em;
            color: #28a745;
            margin-left: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            background: #d1ecf1;
            border-radius: 8px;
            color: #0c5460;
            margin: 15px 0;
        }

        .waiting-message {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            padding: 30px;
        }

        .back-button {
            background: #6c757d;
        }

        .results-container {
            margin: 20px 0;
        }

        .answer-result {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid #c41e3a;
        }

        .answer-result.correct {
            border-left-color: #165b33;
            background: #e8f5e9;
        }

        .answer-result .answer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .answer-result .answer-text-result {
            font-weight: bold;
            font-size: 1.1em;
        }

        .answer-result .points-earned {
            background: #165b33;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #c41e3a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="christmas-theme.jpg" alt="Merry Christmas - Lighting Up Hearts This Christmas" class="christmas-banner">
            <h1>üéÑ HOLIDAY SURVEY SAYS! üéÅ</h1>
        </div>

        <!-- Setup Screen -->
        <div class="setup-screen active" id="setupScreen">
            <div class="role-selection">
                <div class="role-card" onclick="selectRole('host')">
                    <h2>üéÆ Host</h2>
                    <p>Create a new game, control questions, and reveal answers</p>
                </div>
                <div class="role-card" onclick="selectRole('player')">
                    <h2>üë§ Player</h2>
                    <p>Join an existing game and compete with your team</p>
                </div>
            </div>

            <div id="roleForm" style="display: none;">
                <div class="input-group">
                    <label for="nameInput">Your Name:</label>
                    <input type="text" id="nameInput" placeholder="Enter your name" maxlength="20">
                </div>
                <div class="input-group" id="gameCodeGroup" style="display: none;">
                    <label for="gameCodeInput">Game Code:</label>
                    <input type="text" id="gameCodeInput" placeholder="Enter game code" style="text-transform: uppercase;">
                </div>
                <div style="text-align: center;">
                    <button onclick="goBack()" class="back-button">‚Üê Back</button>
                    <button onclick="startGame()" id="continueBtn">Continue</button>
                </div>
                <div id="connectionStatus" class="status-message" style="display: none;">
                    <div class="spinner"></div>
                    <div>Connecting...</div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <!-- Host View -->
            <div id="hostView" style="display: none;">
                <div class="game-code">
                    <h3>üîó Share this code with your team:</h3>
                    <div class="code" id="displayGameCode"></div>
                    <div class="url">Players should open this same page and enter the code above</div>
                </div>

                <div class="players-list">
                    <h3>Players (<span id="playerCount">0</span>)</h3>
                    <div id="playersList"></div>
                </div>

                <div id="hostControls">
                    <div class="status-message" id="hostStatus">Waiting for players to join...</div>
                    <div class="controls">
                        <button onclick="startQuestion()" id="startQuestionBtn">Start Question</button>
                        <button onclick="revealAnswer()" id="revealBtn" style="display: none;">Reveal Answers</button>
                        <button onclick="nextQuestion()" id="nextQuestionBtn" style="display: none;">Next Question</button>
                        <button onclick="endGame()" id="endGameBtn" style="display: none;">End Game</button>
                    </div>
                </div>

                <div id="hostQuestion" style="display: none;">
                    <div class="question-section">
                        <div class="question-header">
                            <div class="question-number" id="hostQuestionNumber"></div>
                            <div class="question" id="hostQuestionText"></div>
                        </div>
                        <div class="timer" id="hostTimer"></div>
                        <div class="status-message" id="answerStatus">Waiting for players to answer...</div>
                    </div>
                </div>

                <div id="hostResults" style="display: none;">
                    <div class="results-container" id="resultsContainer"></div>
                </div>
            </div>

            <!-- Player View -->
            <div id="playerView" style="display: none;">
                <div class="players-list">
                    <h3>Your Score: <span id="playerScore">0</span></h3>
                </div>

                <div id="playerWaiting" class="waiting-message">
                    Waiting for host to start the question...
                </div>

                <div id="playerQuestion" style="display: none;">
                    <div class="question-section">
                        <div class="question-header">
                            <div class="question-number" id="playerQuestionNumber"></div>
                            <div class="question" id="playerQuestionText"></div>
                        </div>
                        <div class="timer" id="playerTimer"></div>
                        <div class="answers-grid" id="playerAnswers"></div>
                    </div>
                </div>

                <div id="playerResults" style="display: none;">
                    <div class="question-section">
                        <h3 style="text-align: center; color: #667eea; margin-bottom: 20px;">Round Results</h3>
                        <div id="playerResultsContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            {
                question: "Name the busiest shopping day at Macy's",
                answers: [
                    { text: "Black Friday", points: 45 },
                    { text: "Day After Christmas", points: 25 },
                    { text: "Thanksgiving Day Parade Day", points: 15 },
                    { text: "Last Saturday Before Christmas", points: 10 },
                    { text: "Mother's Day Weekend", points: 5 }
                ]
            },
            {
                question: "Name something customers always ask employees on the floor",
                answers: [
                    { text: "Where is the restroom?", points: 40 },
                    { text: "Do you have this in a different size?", points: 25 },
                    { text: "Can I use this coupon?", points: 15 },
                    { text: "What time do you close?", points: 12 },
                    { text: "Where's the nearest register?", points: 8 }
                ]
            },
            {
                question: "Name the most common excuse for being late to a meeting",
                answers: [
                    { text: "Another Meeting Ran Over", points: 40 },
                    { text: "Technical Issues", points: 25 },
                    { text: "Lost Track of Time", points: 15 },
                    { text: "Didn't Get Calendar Invite", points: 12 },
                    { text: "Traffic/Commute", points: 8 }
                ]
            },
            {
                question: "Name a Macy's department that people get lost trying to find",
                answers: [
                    { text: "Home Goods/Furniture", points: 35 },
                    { text: "Men's Department", points: 30 },
                    { text: "Juniors", points: 18 },
                    { text: "Shoes", points: 10 },
                    { text: "Customer Service", points: 7 }
                ]
            },
            {
                question: "Name something people always say they'll do on their lunch break but never do",
                answers: [
                    { text: "Go for a Walk", points: 35 },
                    { text: "Work Out/Gym", points: 30 },
                    { text: "Run Errands", points: 18 },
                    { text: "Read a Book", points: 10 },
                    { text: "Meal Prep", points: 7 }
                ]
            },
            {
                question: "Name something that happens during Macy's Friends & Family sale",
                answers: [
                    { text: "Store gets packed", points: 40 },
                    { text: "Lines at registers are long", points: 25 },
                    { text: "Everything is picked over", points: 15 },
                    { text: "Can't find your size", points: 12 },
                    { text: "Dressing rooms are a mess", points: 8 }
                ]
            },
            {
                question: "Name something people do when they're bored in a virtual meeting",
                answers: [
                    { text: "Check Email/Slack", points: 35 },
                    { text: "Browse the Internet", points: 28 },
                    { text: "Multitask on Other Work", points: 20 },
                    { text: "Get Snacks", points: 10 },
                    { text: "Play with Pets", points: 7 }
                ]
            },
            {
                question: "Name something customers say when they can't find what they're looking for",
                answers: [
                    { text: "Can you check in the back?", points: 35 },
                    { text: "Do other stores have it?", points: 25 },
                    { text: "When will you get more?", points: 20 },
                    { text: "Can you order it for me?", points: 12 },
                    { text: "This is ridiculous!", points: 8 }
                ]
            },
            {
                question: "Name the worst time to schedule a meeting",
                answers: [
                    { text: "Friday Afternoon", points: 40 },
                    { text: "Monday Morning", points: 25 },
                    { text: "Lunch Time", points: 20 },
                    { text: "End of Day", points: 10 },
                    { text: "Early Morning (Before 9am)", points: 5 }
                ]
            },
            {
                question: "Name something associated with Macy's Thanksgiving Day Parade",
                answers: [
                    { text: "Giant Balloons", points: 40 },
                    { text: "Santa Claus", points: 28 },
                    { text: "Marching Bands", points: 15 },
                    { text: "Herald Square", points: 10 },
                    { text: "Al Roker", points: 7 }
                ]
            },
            {
                question: "Name something that makes someone a 'good' interviewer",
                answers: [
                    { text: "Good Listener", points: 30 },
                    { text: "Asks Thoughtful Questions", points: 28 },
                    { text: "Makes Candidate Comfortable", points: 22 },
                    { text: "Provides Clear Information", points: 12 },
                    { text: "On Time/Prepared", points: 8 }
                ]
            },
            {
                question: "Name something people say when they're trying to end a conversation",
                answers: [
                    { text: "Well, I'll Let You Go", points: 35 },
                    { text: "I Have Another Meeting", points: 30 },
                    { text: "We Should Circle Back Later", points: 18 },
                    { text: "Anyway...", points: 10 },
                    { text: "I Won't Keep You", points: 7 }
                ]
            },
            {
                question: "Name the reasons why people like shopping at Macy's",
                answers: [
                    { text: "Good sales/discounts", points: 40 },
                    { text: "Wide selection/variety", points: 25 },
                    { text: "Quality brands", points: 15 },
                    { text: "Convenient locations", points: 12 },
                    { text: "Good return policy", points: 8 }
                ]
            },
            {
                question: "Name the reasons why people want to work with Macy's for the Seasonal",
                answers: [
                    { text: "Employee discount", points: 35 },
                    { text: "Flexible hours", points: 30 },
                    { text: "Extra holiday money", points: 20 },
                    { text: "Work experience", points: 10 },
                    { text: "Fun holiday atmosphere", points: 5 }
                ]
            },
            {
                question: "Name what Talent Acquisition like about candidates when they receive outbound calls (candidates know their reference numbers)",
                answers: [
                    { text: "Shows they're prepared", points: 40 },
                    { text: "Professional/organized", points: 30 },
                    { text: "Actually interested in the job", points: 15 },
                    { text: "Easy to verify identity", points: 10 },
                    { text: "Saves time", points: 5 }
                ]
            }
        ];

        let gameState = {
            role: null,
            gameCode: null,
            playerName: null,
            peer: null,
            connections: {},
            players: {},
            currentQuestionIndex: 0,
            timerInterval: null,
            playerAnswers: {},
            isHost: false
        };

        window.selectRole = function(role) {
            gameState.role = role;
            gameState.isHost = role === 'host';
            document.getElementById('roleForm').style.display = 'block';
            if (role === 'player') {
                document.getElementById('gameCodeGroup').style.display = 'block';
            }
        };

        window.goBack = function() {
            document.getElementById('roleForm').style.display = 'none';
            document.getElementById('gameCodeGroup').style.display = 'none';
            document.getElementById('nameInput').value = '';
            document.getElementById('gameCodeInput').value = '';
            gameState.role = null;
        };

        window.startGame = function() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) {
                alert('Please enter your name');
                return;
            }

            gameState.playerName = name;

            if (gameState.isHost) {
                createGame();
            } else {
                const code = document.getElementById('gameCodeInput').value.trim().toUpperCase();
                if (!code) {
                    alert('Please enter a game code');
                    return;
                }
                joinGame(code);
            }
        };

        function createGame() {
            document.getElementById('connectionStatus').style.display = 'block';
            document.getElementById('continueBtn').disabled = true;

            gameState.gameCode = generateGameCode();
            gameState.peer = new Peer(gameState.gameCode);

            gameState.peer.on('open', function(id) {
                console.log('Host peer created with ID:', id);
                document.getElementById('setupScreen').classList.remove('active');
                document.getElementById('gameScreen').classList.add('active');
                document.getElementById('hostView').style.display = 'block';
                document.getElementById('displayGameCode').textContent = gameState.gameCode;
                
                gameState.players[gameState.gameCode] = {
                    name: gameState.playerName,
                    score: 0,
                    isHost: true
                };
                updatePlayersList();
            });

            gameState.peer.on('connection', function(conn) {
                console.log('Player connected:', conn.peer);
                setupConnection(conn);
            });

            gameState.peer.on('error', function(err) {
                console.error('Peer error:', err);
                alert('Connection error. Please try again.');
                document.getElementById('connectionStatus').style.display = 'none';
                document.getElementById('continueBtn').disabled = false;
            });
        }

        function joinGame(code) {
            document.getElementById('connectionStatus').style.display = 'block';
            document.getElementById('continueBtn').disabled = true;

            const playerId = 'player_' + Date.now();
            gameState.peer = new Peer(playerId);

            gameState.peer.on('open', function(id) {
                console.log('Player peer created with ID:', id);
                const conn = gameState.peer.connect(code);
                
                conn.on('open', function() {
                    console.log('Connected to host');
                    gameState.gameCode = code;
                    gameState.connections[code] = conn;
                    
                    conn.send({
                        type: 'join',
                        name: gameState.playerName,
                        playerId: playerId
                    });

                    document.getElementById('setupScreen').classList.remove('active');
                    document.getElementById('gameScreen').classList.add('active');
                    document.getElementById('playerView').style.display = 'block';
                });

                conn.on('data', function(data) {
                    handlePlayerMessage(data);
                });

                conn.on('error', function(err) {
                    console.error('Connection error:', err);
                    alert('Could not connect to game. Please check the code.');
                    document.getElementById('connectionStatus').style.display = 'none';
                    document.getElementById('continueBtn').disabled = false;
                });
            });

            gameState.peer.on('error', function(err) {
                console.error('Peer error:', err);
                alert('Connection error. Please try again.');
                document.getElementById('connectionStatus').style.display = 'none';
                document.getElementById('continueBtn').disabled = false;
            });
        }

        function setupConnection(conn) {
            conn.on('data', function(data) {
                handleHostMessage(data, conn);
            });

            conn.on('close', function() {
                console.log('Player disconnected:', conn.peer);
                delete gameState.connections[conn.peer];
                delete gameState.players[conn.peer];
                updatePlayersList();
            });
        }

        function handleHostMessage(data, conn) {
            console.log('Host received:', data);
            
            if (data.type === 'join') {
                gameState.connections[conn.peer] = conn;
                gameState.players[conn.peer] = {
                    name: data.name,
                    score: 0,
                    playerId: data.playerId
                };
                updatePlayersList();
                
                // Send current game state to new player
                broadcast({ type: 'sync', players: gameState.players });
            } else if (data.type === 'answer') {
                gameState.playerAnswers[conn.peer] = data.answer;
                updateAnswerStatus();
            }
        }

        function handlePlayerMessage(data) {
            console.log('Player received:', data);
            
            if (data.type === 'sync') {
                gameState.players = data.players;
            } else if (data.type === 'question') {
                showPlayerQuestion(data.questionIndex, data.question);
            } else if (data.type === 'reveal') {
                showPlayerResults(data.correctAnswer, data.points);
            } else if (data.type === 'updateScore') {
                document.getElementById('playerScore').textContent = data.score;
            } else if (data.type === 'nextQuestion') {
                hidePlayerResults();
            } else if (data.type === 'gameOver') {
                showGameOver();
            }
        }

        function broadcast(message) {
            Object.values(gameState.connections).forEach(conn => {
                if (conn.open) {
                    conn.send(message);
                }
            });
        }

        function generateGameCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function updatePlayersList() {
            const playersList = document.getElementById('playersList');
            const playerCount = document.getElementById('playerCount');
            
            const playersArray = Object.entries(gameState.players).map(([id, data]) => ({ id, ...data }));
            playerCount.textContent = playersArray.length;

            playersList.innerHTML = playersArray
                .sort((a, b) => (b.score || 0) - (a.score || 0))
                .map(player => {
                    const hasAnswered = gameState.playerAnswers[player.id] !== undefined;
                    const status = hasAnswered ? '<span class="player-status">‚úì Answered</span>' : '';
                    return `
                        <div class="player-item ${hasAnswered ? 'answered' : ''}">
                            <div>
                                <span class="player-name">${player.name}</span>
                                ${status}
                            </div>
                            <span class="player-score">${player.score || 0} pts</span>
                        </div>
                    `;
                }).join('');
        }

        function updateAnswerStatus() {
            const answered = Object.keys(gameState.playerAnswers).length;
            const total = Object.keys(gameState.players).length;
            document.getElementById('answerStatus').textContent = 
                `${answered} of ${total} players have answered`;
            updatePlayersList();
        }

        window.startQuestion = function() {
            if (gameState.currentQuestionIndex >= questions.length) {
                alert('All questions completed!');
                return;
            }

            gameState.playerAnswers = {};
            const question = questions[gameState.currentQuestionIndex];

            broadcast({
                type: 'question',
                questionIndex: gameState.currentQuestionIndex,
                question: question
            });

            document.getElementById('hostStatus').style.display = 'none';
            document.getElementById('startQuestionBtn').style.display = 'none';
            document.getElementById('hostQuestion').style.display = 'block';
            document.getElementById('hostQuestionNumber').textContent = 
                `Question ${gameState.currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('hostQuestionText').textContent = question.question;

            startTimer('host', 10);
            updateAnswerStatus();

            setTimeout(() => {
                document.getElementById('revealBtn').style.display = 'inline-block';
            }, 10000);
        };

        window.revealAnswer = function() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }

            const question = questions[gameState.currentQuestionIndex];
            
            // Calculate scores
            Object.entries(gameState.playerAnswers).forEach(([playerId, answerIndex]) => {
                if (gameState.players[playerId]) {
                    const points = question.answers[answerIndex].points;
                    gameState.players[playerId].score += points;
                }
            });

            // Show results on host screen
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = question.answers.map((answer, index) => {
                const playersWhoChose = Object.entries(gameState.playerAnswers)
                    .filter(([_, ans]) => ans === index)
                    .map(([id]) => gameState.players[id]?.name)
                    .filter(Boolean);
                
                return `
                    <div class="answer-result ${playersWhoChose.length > 0 ? 'correct' : ''}">
                        <div class="answer-header">
                            <span class="answer-text-result">${answer.text}</span>
                            <span class="points-earned">${answer.points} pts</span>
                        </div>
                        ${playersWhoChose.length > 0 ? `<div>Chosen by: ${playersWhoChose.join(', ')}</div>` : ''}
                    </div>
                `;
            }).join('');

            document.getElementById('hostQuestion').style.display = 'none';
            document.getElementById('hostResults').style.display = 'block';
            document.getElementById('revealBtn').style.display = 'none';
            document.getElementById('nextQuestionBtn').style.display = 'inline-block';
            document.getElementById('endGameBtn').style.display = 'inline-block';

            updatePlayersList();

            // Send results to players
            Object.entries(gameState.connections).forEach(([playerId, conn]) => {
                const playerAnswer = gameState.playerAnswers[playerId];
                const points = playerAnswer !== undefined ? question.answers[playerAnswer].points : 0;
                
                conn.send({
                    type: 'reveal',
                    correctAnswer: playerAnswer,
                    points: points,
                    allAnswers: question.answers
                });

                conn.send({
                    type: 'updateScore',
                    score: gameState.players[playerId]?.score || 0
                });
            });
        };

        window.nextQuestion = function() {
            gameState.currentQuestionIndex++;
            gameState.playerAnswers = {};

            if (gameState.currentQuestionIndex >= questions.length) {
                endGame();
                return;
            }

            broadcast({ type: 'nextQuestion' });

            document.getElementById('hostResults').style.display = 'none';
            document.getElementById('hostQuestion').style.display = 'none';
            document.getElementById('nextQuestionBtn').style.display = 'none';
            document.getElementById('endGameBtn').style.display = 'none';
            document.getElementById('startQuestionBtn').style.display = 'inline-block';
            document.getElementById('hostStatus').textContent = 'Ready for next question!';
            document.getElementById('hostStatus').style.display = 'block';
        };

        window.endGame = function() {
            broadcast({ type: 'gameOver' });
            
            document.getElementById('hostResults').style.display = 'none';
            document.getElementById('hostQuestion').style.display = 'none';
            document.getElementById('nextQuestionBtn').style.display = 'none';
            document.getElementById('endGameBtn').style.display = 'none';
            document.getElementById('hostStatus').innerHTML = 'üéâ <strong>Game Over!</strong> Final scores above.';
            document.getElementById('hostStatus').style.display = 'block';
        };

        function showPlayerQuestion(questionIndex, question) {
            document.getElementById('playerWaiting').style.display = 'none';
            document.getElementById('playerResults').style.display = 'none';
            document.getElementById('playerQuestion').style.display = 'block';
            
            document.getElementById('playerQuestionNumber').textContent = 
                `Question ${questionIndex + 1} of ${questions.length}`;
            document.getElementById('playerQuestionText').textContent = question.question;
            
            const answersGrid = document.getElementById('playerAnswers');
            answersGrid.innerHTML = question.answers.map((answer, index) => `
                <div class="answer-option" onclick="selectAnswer(${index})" data-index="${index}">
                    <span>${answer.text}</span>
                </div>
            `).join('');

            startTimer('player', 10);
        }

        function showPlayerResults(selectedIndex, points) {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }

            document.getElementById('playerQuestion').style.display = 'none';
            document.getElementById('playerResults').style.display = 'block';

            const question = questions[gameState.currentQuestionIndex];
            const resultsContent = document.getElementById('playerResultsContent');

            if (selectedIndex !== null && selectedIndex !== undefined) {
                const selectedAnswer = question.answers[selectedIndex];
                resultsContent.innerHTML = `
                    <div class="answer-result correct">
                        <div class="answer-header">
                            <span class="answer-text-result">You selected: ${selectedAnswer.text}</span>
                            <span class="points-earned">+${points} pts</span>
                        </div>
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">All Answers:</h4>
                        ${question.answers.map(answer => `
                            <div class="answer-result" style="margin: 10px 0;">
                                <div class="answer-header">
                                    <span>${answer.text}</span>
                                    <span class="points-earned" style="background: #d4af37; color: #333;">${answer.points} pts</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                resultsContent.innerHTML = `
                    <div class="answer-result">
                        <div class="answer-header">
                            <span class="answer-text-result">You didn't answer in time!</span>
                            <span class="points-earned">0 pts</span>
                        </div>
                    </div>
                `;
            }
        }

        function hidePlayerResults() {
            document.getElementById('playerResults').style.display = 'none';
            document.getElementById('playerWaiting').textContent = 'Waiting for host to start the next question...';
            document.getElementById('playerWaiting').style.display = 'block';
        }

        function showGameOver() {
            document.getElementById('playerResults').style.display = 'none';
            document.getElementById('playerWaiting').innerHTML = 'üéâ <strong>Game Over!</strong><br>Thanks for playing!';
            document.getElementById('playerWaiting').style.display = 'block';
        }

        window.selectAnswer = function(index) {
            const options = document.querySelectorAll('.answer-option');
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                opt.classList.add('disabled');
            });
            options[index].classList.add('selected');

            const conn = gameState.connections[gameState.gameCode];
            if (conn && conn.open) {
                conn.send({
                    type: 'answer',
                    answer: index
                });
            }
        };

        function startTimer(view, seconds) {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }

            let remaining = seconds;
            const timerElement = document.getElementById(view === 'host' ? 'hostTimer' : 'playerTimer');
            
            const updateTimer = () => {
                timerElement.textContent = remaining;
                if (remaining <= 3) {
                    timerElement.classList.add('warning');
                } else {
                    timerElement.classList.remove('warning');
                }
                if (remaining <= 0) {
                    clearInterval(gameState.timerInterval);
                    timerElement.textContent = "Time's Up!";
                    if (view === 'player') {
                        const options = document.querySelectorAll('.answer-option');
                        options.forEach(opt => opt.classList.add('disabled'));
                    }
                }
                remaining--;
            };

            updateTimer();
            gameState.timerInterval = setInterval(updateTimer, 1000);
        }
    </script>
</body>
</html>